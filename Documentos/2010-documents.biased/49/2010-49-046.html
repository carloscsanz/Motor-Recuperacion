<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
 <head>
  <title>
   java upload applet - MyUploader
  </title>
  <meta name="keywords" content="file upload applet, upload multiple files, large file upload, upload tool">
  <meta name="description" content="MyUploader is a file upload applet for uploading files to a web server. With MyUploader you can easily upload multiple files. Free Trial.">
  <link rel="stylesheet" type="text/css" href="../css/style.css">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <script type="text/javascript" src="../scripts/nl.js"></script>
 </head>

 <body class="body">
  <script type="text/javascript" src="../scripts/sub-toolbar-menu.js"></script>
  <img src="../images/logo.png" alt="logo" border="0" align="middle">
  <br>
  <br>
  <table cellpadding="0" cellspacing="0" border="0" width="760">
  <tr>
   <td width="150" valign="top">
    <script type="text/javascript" src="../scripts/menu-myuploader.js"></script>
    <br>
    <script type="text/javascript" src="../scripts/sub-nlform.js"></script>
    <br>
    <br>
   </td>
   <td width="610" valign="top">
    <table border="0" cellpadding="0" cellspacing="0" width="610">
    <tr>
     <td width="10" align="center"></td><!-- Column 1 -->
     <td class="text1" width="610" valign="top">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr>
       <td valign="top" align="left" class="title">
Code examples - MyUploader
       </td>
      </tr>
      <tr>
       <td valign="top" align="left" class="text">
         <b>Example 1:</b>
         <br>
         Sends an email notification after the upload.
         <br>
         Download: 
         <a href="./examples/myuploader-email-php.zip" class="detaillink">PHP</a>,
         <a href="./examples/myuploader-email-java.zip" class="detaillink">Java</a>,
         <a href="./examples/myuploader-email-struts1.zip" class="detaillink">Struts 1</a>,
         <a href="./examples/myuploader-email-net.zip" class="detaillink">ASP.NET</a>,
         <a href="./examples/myuploader-email-csharp.zip" class="detaillink">C#</a>,
         <a href="./examples/myuploader-email-classic-asp.zip" class="detaillink">Classic ASP</a>
         <br><br>
       </td>
      </tr>
      <tr>
       <td valign="top" align="left" class="text">
         <b>Example 2:</b>
         <br>
         Shows a list of the upload files on the success page. This example uses sessions.
         <br>
         Download: 
         <a href="./examples/myuploader-list-php.zip" class="detaillink">PHP</a>,
         <a href="./examples/myuploader-list-java.zip" class="detaillink">Java</a>,
         <a href="./examples/myuploader-list-net.zip" class="detaillink">ASP.NET</a>,
         <a href="./examples/myuploader-list-csharp.zip" class="detaillink">C#</a>,
         <a href="./examples/myuploader-list-classic-asp.zip" class="detaillink">Classic ASP</a>
         <br><br>
       </td>
      </tr>
      <tr>
       <td valign="top" align="left" class="text">
         <b>Example 3:</b>
         <br>
         MyUploader with form based authentication. This example uses sessions.
         <br>
         Download: 
         <a href="./examples/myuploader-auth-php.zip" class="detaillink">PHP</a>         
         <br><br>
       </td>
      </tr>
      <tr>
       <td valign="top" align="left" class="text">
        The examples are based on the following code.
       </td>
      </tr>
      <tr>
       <td class="text">
		<table cellspacing="0" cellpadding="5" width="350">
        <tr>
         <td>
          <table class="update1" cellpadding="5" cellspacing="0">
          <tr>
           <td>
            <table cellpadding="0" cellspacing="0">
            <tr>
             <td class="listtitle">
              Base code examples
              <br>
              <br>
             </td>
            </tr>
            <tr>
             <td width="200">
              <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#servlet" class="footerlink">Servlet</a>
             </td>
            </tr>
            <tr>
             <td width="200">
              <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#jsp" class="footerlink">JSP</a>
             </td>
            </tr>
            <tr>
             <td>
              <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#asp" class="footerlink">ASP.NET</a>
             </td>
            </tr>
			
			<tr>
                    <td>
                      <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#csharp" class="footerlink">C#</a>
                    </td>
                  </tr>
			<tr>
                    <td>
                      <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#classic-asp" class="footerlink">Classic ASP</a>
                    </td>
                  </tr>
                <tr>
                    <td>
                      <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#php" class="footerlink">PHP</a>
                    </td>
                  </tr>
			<tr>
                    <td>
                      <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#perl" class="footerlink">Perl</a>
                    </td>
                  </tr> 
                   <tr>
                    <td>
                      <img src="./../images/approve.gif" alt="yes" border="0" align="left">&nbsp;<a href="./samplecode.html#coldfusion" class="footerlink">Coldfusion</a>
                    </td>
                  </tr> 
                </table>
               </td>
                  </tr>
                </table>
               
              </td>
            </tr>
          </table>
          
          
							
						<td>									
					</tr>
    <tr>
						<td><div class="subtitle"><a name="servlet">Java (Servlet)</a></div></td>
					</tr>
					<tr>
						<td class="text"><br>
The following Java Servlet uses the libraries <a href="http://jakarta.apache.org/commons/fileupload" class="detaillink">Commons FileUpload 1.1.1</a> and <a href="http://jakarta.apache.org/commons/io" class="detaillink">Commons IO 1.2</a> of Apache. 
To download the required libraries, click <a href="http://jakarta.apache.org/site/downloads/downloads_commons-fileupload.cgi" class="detaillink">here</a> for Apache FileUpload and <a href="http://jakarta.apache.org/site/downloads/downloads_commons-io.cgi" class="detaillink">here</a> for Apache IO. 
The Servlet runs in an application server, such as the Open Source application server 
<a href="http://tomcat.apache.org/" class="detaillink">Apache Tomcat</a>. See the documentation of 
your application server for installing the Servlet.

<br><br>The Servlet stores the files in the directory '/tmp' - you can change this if you like, to
for example 'c://temp' for a Windows environment. To download the Servlet click <a href="http://www.javaatwork.com/UploadServlet.java" class="detaillink">here</a>.
<br><br>
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">
<pre class="text">
package uploadserver;

import java.io.File;
import java.io.IOException;
import java.net.URLDecoder;
import java.util.Iterator;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileItemFactory;
import org.apache.commons.fileupload.FileUpload;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

/**
 * Class for storing the uploaded files.
 * 
 * @author JavaAtWork
 */
public class UploadServlet extends HttpServlet {

  /**
    * The base upload directory. In this directory all uploaded files will
    * be stored. With the applet param tag 'directory' you can create a
    * subdirectory for a user. 
    * See http://www.javaatwork.com/parameters.html#directory for more 
    * information about the 'directory' param tag. For a Windows environment 
    * the BASE_DIRECTORY can be e.g. * 'c:/temp' for Linux environment '/tmp'.
    */
  private static final String BASE_DIRECTORY = "/tmp";

  protected void doPost(HttpServletRequest request, HttpServletResponse response) 
    throws ServletException, IOException {

    boolean isMultipart = ServletFileUpload.isMultipartContent(request);

    // check if the http request is a multipart request
    // with other words check that the http request can have uploaded files
    if (isMultipart) {

      //  Create a factory for disk-based file items
      FileItemFactory factory = new DiskFileItemFactory();

      //  Create a new file upload handler
      ServletFileUpload servletFileUpload = new ServletFileUpload(factory);

      // Set upload parameters
      // See Apache Commons FileUpload for more information
      // http://jakarta.apache.org/commons/fileupload/using.html
      servletFileUpload.setSizeMax(-1);

      try {

        String directory = "";

        // Parse the request
        List items = servletFileUpload.parseRequest(request);

        // Process the uploaded items
        Iterator iter = items.iterator();

        while (iter.hasNext()) {
          FileItem item = (FileItem) iter.next();

          // the param tag directory is sent as a request parameter to
          // the server
          // check if the upload directory is available
          if (item.isFormField()) {

            String name = item.getFieldName();

            if (name.equalsIgnoreCase("directory")) {

              directory = item.getString();
            }

            // retrieve the files
          } else {

            // the fileNames are urlencoded
            String fileName = URLDecoder.decode(item.getName());

            File file = new File(directory, fileName);
            file = new File(BASE_DIRECTORY, file.getPath());

            // retrieve the parent file for creating the directories
            File parentFile = file.getParentFile();

            if (parentFile != null) {
              parentFile.mkdirs();
            }

            // writes the file to the filesystem
            item.write(file);
          }
        }

      } catch (Exception e) {
        e.printStackTrace();
        response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
      }

      response.setStatus(HttpServletResponse.SC_OK);

    } else {
      response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
    }
  }
}

</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>								
								<tr>
									<td><div class="subtitle"><a name="jsp">JSP</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>
The following JSP uses the libraries <a href="http://jakarta.apache.org/commons/fileupload" class="detaillink">Commons FileUpload 1.1.1</a> and <a href="http://jakarta.apache.org/commons/io" class="detaillink">Commons IO 1.2</a> of Apache. 
To download the required libraries, click <a href="http://jakarta.apache.org/site/downloads/downloads_commons-fileupload.cgi" class="detaillink">here</a> for Apache FileUpload and <a href="http://jakarta.apache.org/site/downloads/downloads_commons-io.cgi" class="detaillink">here</a> for Apache IO. 
The JSP runs in an application server, such as the Open Source application server 
<a href="http://tomcat.apache.org/" class="detaillink">Apache Tomcat</a>. See the documentation of 
your application server for installing the JSP.

<br><br>The JSP stores the files in the directory '/tmp' - you can change this if you like, to
for example 'c://temp' for a Windows environment. To download the JSP click <a href="http://www.javaatwork.com/upload.jsp" class="detaillink">here</a>.

<br><br>		
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">								
<pre class="text">
&lt;%@ page import="java.io.*" %&gt;
&lt;%@ page import="java.net.*" %&gt;
&lt;%@ page import="java.util.*" %&gt;
&lt;%@ page import="org.apache.commons.fileupload.*" %&gt;
&lt;%@ page import="org.apache.commons.fileupload.servlet.*" %&gt;
&lt;%@ page import="org.apache.commons.fileupload.disk.*" %&gt;

&lt;%
boolean isMultipart = ServletFileUpload.isMultipartContent(request);

// check if the http request is a multipart request
// with other words check that the http request can have uploaded files
if (isMultipart) {

  
  // The base upload directory. In this directory all uploaded files will
  // be stored. With the applet param tag 'directory' you can create a
  // subdirectory for a user. 
  // See http://www.javaatwork.com/parameters.html#directory for more 
  // information about the 'directory' param tag. For a Windows environment 
  // the base_directory can be e.g. 'c:/temp' for Linux environment '/tmp'.
  String base_directory = "c:/temp";

  // Create a factory for disk-based file items
  FileItemFactory factory = new DiskFileItemFactory();

  // Create a new file upload handler
  ServletFileUpload servletFileUpload = new ServletFileUpload(factory);

  // Set upload parameters
  // See Apache Commons FileUpload for more information
  // http://jakarta.apache.org/commons/fileupload/using.html
  servletFileUpload.setSizeMax(-1);

  try {

    String directory = "";

    // Parse the request
    List items = servletFileUpload.parseRequest(request);

    // Process the uploaded items
    Iterator iter = items.iterator();

    while (iter.hasNext()) {
      FileItem item = (FileItem) iter.next();

      // the param tag directory is sent as a request parameter to the server
      // check if the upload directory is available
      if (item.isFormField()) {

        String name = item.getFieldName();

        if (name.equalsIgnoreCase("directory")) {

          directory = item.getString();
        }

        // retrieve the files
      } else {

        // the fileNames are urlencoded
        String fileName = URLDecoder.decode(item.getName());

        File file = new File(directory, fileName);
        file = new File(base_directory, file.getPath());

        // retrieve the parent file for creating the directories
        File parentFile = file.getParentFile();

        if (parentFile != null) {
          parentFile.mkdirs();
        }

        // writes the file to the filesystem
        item.write(file);
      }
    }

  } catch (Exception e) {
    e.printStackTrace();
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
  }
}

%&gt;</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>								
								<tr>
									<td><div class="subtitle"><a name="asp">ASP.NET</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>

The ASP.NET example stores the files in the directory 'c:\temp\'. The directory can be changed with the variable 'baseDirectory', see below.
To download the ASP.NET code click <a href="http://www.javaatwork.com/upload.aspx" class="detaillink">here</a>.
<br><br>By default, ASP.NET only allows files up to 4096KBytes (4MB) in size to be uploaded to the web server. 
To upload larger files, you will need to change the maxRequestLength and executionTimeout 
parameter of the &lt;httpRuntime&gt; section found in the web.config and/or machine.config file.


<br><br>		
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">								
<pre class="text">
&lt;%@ import namespace="System.IO" %&gt;

&lt;script language="vb" runat="server"&gt;

Protected Sub Page_Load(s As Object, e As EventArgs)

   Try
      Dim baseDirectory As String = "c:\temp\"           
      Dim uploadDirectory As String = Request("directory")
      Dim combination1 As String
      Dim PostedFile As HttpPostedFile

      If Not uploadDirectory  = "" Then
         combination1 = Path.Combine(baseDirectory , uploadDirectory)
      Else
         combination1 = baseDirectory
      End If

      For i As Integer = 0 To Request.Files.Count - 1

         PostedFile = Request.Files(i)

         ' Creates the full path
         Dim combination2 As String = _
         Path.Combine(combination1, HttpUtility.UrlDecode(PostedFile.FileName))   

         ' Create the directories
         Dim dir As New DirectoryInfo(Path.GetDirectoryName(combination2))
         dir.Create                          

         ' Save the uploaded file
         PostedFile.SaveAs(combination2)

      Next

   Catch ex As Exception

      Console.WriteLine("Exception occurred: ", ex.ToString())

      ' Internal server error
      Response.StatusCode = 500               

   End Try

End Sub

&lt;/script&gt;
</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>
								<tr>
									<td><div class="subtitle"><a name="csharp">C#</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>

The C# example stores the files in the directory 'c:\temp\'. The directory can be changed with the variable 'baseDirectory', see below.
To download the C# code click <a href="http://www.javaatwork.com/csharp.aspx" class="detaillink">here</a>.
<br><br>By default, C# only allows files up to 4096KBytes (4MB) in size to be uploaded to the web server. 
To upload larger files, you will need to change the maxRequestLength and executionTimeout 
parameter of the &lt;httpRuntime&gt; section found in the web.config and/or machine.config file.


<br><br>		
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">								
<pre class="text">
&lt;%@ Page Language="C#" %&gt;
&lt;%@ Import namespace="System.IO" %&gt;

&lt;script language="C#" runat="server"&gt;

protected void Page_Load(object sender, EventArgs e)
{
    try
    {
       String baseDirectory = "c:\\temp";
       String uploadDirectory = Request["directory"];
       String folders;
       HttpPostedFile PostedFile;

       if (uploadDirectory != null && uploadDirectory != "")
       {
           folders = Path.Combine(baseDirectory, uploadDirectory);
       }
       else
       {
           folders = baseDirectory;
       }

       for (int i = 0; i < Request.Files.Count; i++)
       {
           PostedFile = Request.Files[i];

           // Creates the full path
           String filePath = Path.Combine(folders, HttpUtility.UrlDecode(PostedFile.FileName));

           // Create the directories
           DirectoryInfo dir = new DirectoryInfo(Path.GetDirectoryName(filePath));
           dir.Create();

           // Save the uploaded file
           PostedFile.SaveAs(filePath);
        }
    }
    catch(Exception ex)
    {
        // Internal server error
        Response.StatusCode = 500;
        Response.Status = "500 Error: " + ex.ToString();
    }
}
&lt;/script&gt;
</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>

								<tr>
									<td><div class="subtitle"><a name="classic-asp">Classic ASP</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>
To download the sample code click <a href="http://www.javaatwork.com/upload.asp" class="detaillink">here</a>. The files will be stored in the folder "c:\temp\". To change this update the base_directory
and change if necessary the permissions of the directory.<br><br>

For IIS6.0 users the maximum upload size is limited to the value of the AspMaxRequestEntityAllowed property.
 The default size is 200,000 Bytes (200 KB). 
To change the value open the metabase.XML file which is located in c:\Windows\System32\Inetsrv and change 
the value of AspMaxRequestEntityAllowed to e.g. 104857600, this is 100mb. 
You need to stop the IIS Service before you can edit the file.
<br><br>
See for more information:
<a href="http://support.microsoft.com/kb/327659" class="detaillink">http://support.microsoft.com/kb/327659</a>.
<br><br>
									</td>
								</tr>								
								
								<tr>
									<td><div class="subtitle"><a name="php">PHP</a></div></td>
								</tr>

								<tr>
									<td class="text"><br>
Place the following php code in a file with extension php (e.g. upload.php), then change the  
base_directory. The base_directory is the root directory where the uploaded files will be stored.
In the next example, the base_directory is "c:/temp" - you can change this if you like to 
 e.g. "/tmp/images" for a Linux environment. The base_directory must already exist.
<br><br>
PHP can retrieve as default files up to 2MB. If you need to upload larger files you must change the following settings of 
the php.ini file (for example):
<br><br>
upload_max_filesize = 50M ; Maximum allowed size for uploaded files (max: 1990M).<br>
post_max_size = 60M ; Maximum size of POST data that PHP will accept (max: 1990M).<br>
memory_limit = 70M      ; Maximum amount of memory a script may consume (max: 1990M).<br>
<br>
Large files requires also more resources. You need probably also change the following settings:<br>

<br>
max_execution_time = 30     ; Maximum execution time of each script, in seconds<br>
max_input_time = 60	; Maximum amount of time each script may spend parsing request data<br>
<br>
See for more information: <a href="http://nl3.php.net/manual/en/features.file-upload.php" class="detaillink">php</a>.
<br><br>
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">
<pre class="text">
&lt;?php

$base_directory = "uploaded-files";
$directory = $_REQUEST['directory'];
$upload_dir = "";
$file = "";
$dir = "";

$POST_MAX_SIZE = ini_get('post_max_size');
$mul = substr($POST_MAX_SIZE, -1);
$mul = ($mul == 'M' ? 1048576 : ($mul == 'K' ? 1024 : ($mul == 'G' ? 1073741824 : 1)));

// check if the size is not larger than the size of the php.ini file
if ($_SERVER['CONTENT_LENGTH'] > $mul*(int)$POST_MAX_SIZE && $POST_MAX_SIZE) {
	
   error_log("Total upload size is larger than post_max_size directive in the " . 
      "php.ini file ($POST_MAX_SIZE)");
   error_log("The php.ini file is the configuration file of PHP");
   error_log("Please check and change the post_max_size, upload_max_filesize " . 
      "and memory_limit directives");
   error_log("The maximum value of these directives is 1990M");
   error_log("Increase also the max_execution_time and the max_input_time directives");
   header("HTTP/1.0 500 Internal Server Error");
   exit;
}

// check if $base_directory exist
if (!is_dir($base_directory)) {
     
     error_log('The $base_directory \'' . $base_directory . "' does not exist");
     error_log('Please check the $base_directory in the upload.php script');
     header("HTTP/1.0 500 Internal Server Error");
     exit;
}

// check if the $base_directory is writeable
if (!is_writeable($base_directory)) {
     error_log("The base_directory '" . $base_directory . "' has no write permissions.");
     header("HTTP/1.0 500 Internal Server Error");
     exit;
}

determineUploadDirectory();

foreach ($_FILES["userfile"]["error"] as $key => $error) {

   if ($error == UPLOAD_ERR_OK) {

      $tmp_name = $_FILES["userfile"]["tmp_name"][$key];

      $name = $_FILES["userfile"]["name"][$key];

      $decoded_name = urldecode($name);

      $pos = strrpos($decoded_name, "/");

      if ($pos === false) { 
         $file = $decoded_name;
         $path = $upload_dir;
      } else {
         $file = substr($decoded_name, $pos + 1);
         $dir = substr($decoded_name, 0, $pos);
         $path = $upload_dir . "/" . $dir;
      }	
      
      mkdir_recursive($path);
      
      if(!move_uploaded_file($tmp_name, $path . "/" . $file)) {
         if (!is_dir($path)) {
	    error_log("File: '" . $file . "' cannot be saved because the directory '" 
              . $path . "' does not exist.");
         } else if (!is_writeable($path)) {
            error_log("File: '" . $file . "' cannot be saved because the directory '" 
             . $path . "' has no write permissions.");
	 }
      }

   } else {
      switch ($error) {
         case UPLOAD_ERR_INI_SIZE:
            error_log("The uploaded file exceeds the upload_max_filesize directive (" 
             . ini_get("upload_max_filesize") . ") in php.ini.");
            break;
         case UPLOAD_ERR_FORM_SIZE:
            error_log("The uploaded file exceeds the MAX_FILE_SIZE directive that" 
             . " was specified in the HTML form.");
            break;
         case UPLOAD_ERR_PARTIAL:
            error_log("The uploaded file was only partially uploaded.");
            break;
         case UPLOAD_ERR_NO_FILE:
            error_log("No file was uploaded.");
            break;
         case UPLOAD_ERR_NO_TMP_DIR:
            error_log("Missing a temporary folder.");
            break;
         case UPLOAD_ERR_CANT_WRITE:
            error_log("Failed to write file to disk");
            break;
      }   
   
      header("HTTP/1.0 500 Internal Server Error");
      exit;
   }
}

//-----------------------------------------------------------------------------
//  FUNCTIONS
//-----------------------------------------------------------------------------

// Creates the uploaddirectory. The uploaddirectory is based on the
// base_directory and the directory. The directory is the unique
// directory for every user. You can specify this directory in the
// param tag of the applet tag. See http://www.javaatwork.com/parameters.html
// The base_directory is specified in this php script.
// This method ensures that there's only one slash between the directories.
// e.g. c:/temp/files instead of c:/temp//files
function determineUploadDirectory() {

   global $base_directory, $directory, $upload_dir;

   //remove the slash of base_directory
   $len = strlen ($base_directory);

   $charAt = $base_directory{$len -1};

   if ($charAt == '/') {
      $base_directory =  substr ($base_directory, 0, $len -1);
   }

   // remove the slashes from $directory
   $charAt = $directory{0};

   if ($charAt == '/') {
      $directory =  substr($directory, 1);
   }

   $len = strlen ($directory);

   if ($len != 0) {
      $charAt = $directory{$len - 1};

      if ($charAt == '/') {
         $directory =  substr($directory, 0, $len -1);
      }

      $len = strlen ($directory );

      $upload_dir = $base_directory . "/" . $directory;
   } else {
      $upload_dir = $base_directory;
   }
}

// Creates the directories if needed.
function mkdir_recursive($dir){

   do {
      $tempdir = $dir;
      while (!is_dir($tempdir)) {
         $basedir = dirname($tempdir);

         if ($basedir == '/' || is_dir($basedir)) {
            mkdir($tempdir,0757);

            // sometimes the chmod in the mkdir method doesn't work
            chmod($tempdir, 0757);

         } else {
            $tempdir=$basedir;
         }
      }
   } while ($tempdir != $dir);
}
?&gt;</pre>
</td></tr>
</table>


									</td>
								</tr>
<tr>
									<td><div class="subtitle"><a name="perl">Perl</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>
The Perl example stores the files in the directory '/tmp/files' - you can change this for your own needs to for example 'c:/temp/files' for a Windows environment. 
<br><br>
The first line of the code below is the location of the perl interpreter. On a Linux machine this is often #!/usr/local/bin/perl or #!/usr/bin/perl. If
you executed the script and you will get an 500 http response code than probably the location is incorrect.<br><br>
The Perl example uses the CGI.pm library. Be sure that the script has 755 file permissions. You can change the permissions with most FTP Clients.
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">
<pre class="text">
#!/usr/local/bin/perl

$base_directory = "/tmp/files";
$max_file_size = 100*1024*1024; # 100 MB, -1: unlimited

use CGI qw/:standard/;

$CGI::POST_MAX = $max_file_size;

$query = new CGI;

if ((scalar $query->param) < 1)
{
   print "invalid body"; # will cause premature header error
   exit;
}

$base_directory = $base_directory . '/' . $query->param('directory') . '/';
$base_directory =~ s{//}{/}g;

foreach $ptmp ($query->param)
{
   if ($ptmp !~ /userfile/)
   {
      next;
   }
   @tmps = $query->param($ptmp);
   @infiles = $query->upload($ptmp);
   $i = 0;
   foreach $tmp (@tmps)
   {
      $infile = $tmps[$i++];
      $tmp =~ s/\%([A-Fa-f0-9]{2})/pack('C', hex($1))/seg;
      $tmp =~ s/\+/ /sg;
      $tmp =~ s/\\/\//g;
      $tmp =~ s/^\/(.+)$/$1/g;
      $tmp =~ s/\.\././g;
      $filename = $base_directory . $tmp;
      $dir = $filename;
      $dir =~ s/^(.+\/)[^\/]+$/$1/;
      @dirs = split('/', $dir);
      $cur = '';
      foreach $d (@dirs)
      {
         $cur = $cur . $d . '/';
         if ($cur !~ /\/[^\/]+/)
         {
            next;
         }
         mkdir $cur;
         if ($! ne '' && $! ne 'File exists')
         {
            print "could not make dir $cur"; # premature header error
            exit;
         }
      }
      open $outfile, ">$filename";
      binmode $outfile;
      binmode $infile;
      while (<$infile>)
      {
         print $outfile $_;
      }
      close $outfile;
      close $infile;
   }
}

print "Content-Type: text/html\r\n\r\n";
exit;
</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>								

<tr>
									<td><div class="subtitle"><a name="coldfusion">Coldfusion</a></div></td>
								</tr>
								<tr>
									<td class="text"><br>
The Coldfusion example stores the files in the directory '/tmp/files' - you can change this for your own needs to for example 'c://temp/files' for a Windows environment. 
The code make use of a temporary directory (temp_directory). You can also change this directory.
<br><br>To download the Coldfusion code click <a href="http://www.javaatwork.com/upload.cfm" class="detaillink">here</a>.
<table  border="0" cellpadding="5" cellspacing="0" width="300" align="center" class="update1">							
<tr><td class="text" bgcolor="#D8D8D8">
<pre class="text">
&lt;!--- CHANGE THIS! ---&gt;
&lt;!--- The directory where the files will be stored. This directory must be present. ---&gt;
&lt;cfset base_directory="/tmp/files"&gt;	

&lt;!--- CHANGE THIS! ---&gt; 
&lt;!--- Directory where the files are temporary stored. This directory must be present. ---&gt;
&lt;cfset temp_directory="/tmp"&gt;

&lt;cfloop index="LoopCount" from="1" to="100000"&gt;
  &lt;cfif IsDefined("Form.file_#LoopCount#")&gt;
		
    &lt;!--- Store the file in the temp directory ---&gt;
    &lt;cffile action="upload" fileField="file_#LoopCount#" 
          destination="#temp_directory#" nameConflict="overwrite"&gt;

    &lt;!--- Retrieve the urldecoded uploaded name, e.g. "images/img001.jpg" ---&gt;
    &lt;cfset clientfile=URLDecode(#cffile.clientFile#)&gt;
		
    &lt;!--- Determine the absolute path ---&gt;
    &lt;cfif IsDefined("Form.directory")&gt;
      &lt;cfset path=#base_directory# & "/" & #Form.directory# & "/" & #clientfile#&gt;
    &lt;cfelse&gt;
      &lt;cfset path=#base_directory# & "/" & #clientfile#&gt;
    &lt;/cfif&gt;

    &lt;cfset dir=GetDirectoryFromPath(#path#)&gt;

    &lt;!--- Create if necessary the directory where the file will be stored. ---&gt;
    &lt;cfif not DirectoryExists(#dir#)&gt;
      &lt;cfdirectory action="create" directory="#dir#"&gt;
    &lt;/cfif&gt;

    &lt;cfset serverPath=#cffile.serverDirectory# & "/" & #cffile.clientFile#&gt;

    &lt;!--- move the file to the final destination ---&gt;
    &lt;cffile action="move" source="#serverPath#" destination="#path#"&gt;

    &lt;cfelse&gt;
    &lt;cfabort&gt;
  &lt;/cfif&gt;
&lt;/cfloop&gt;

</pre>
</td></tr>
</table>
<br><br>
									</td>
								</tr>								


		
          </table>
          	</td>
								</tr>

		
          </table>
        </td><!-- End Column 1 -->
      </tr>
    </table>
    <br>
    <img align="bottom" src="./../images/dot.gif" alt="dot" width="760" height="2" border="0">
    <div class="footer">
      <a href="./../sitemap.html" class="footerlink">site map</a> | <a href="./../termsofuse.html" class="footerlink">terms of use</a> | <a href="./../policy.html" class="footerlink">privacy policy</a>
      <br>
      &copy; 2005-2010&nbsp;<a href="http://www.javaatwork.com" class="footerlink">JavaAtWork - file &amp; folder upload solutions</a>
    </div>
  </body>
</html>

