<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
	<title>ASP Ninja</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	
	<link rel="alternate" type="application/rss+xml" href="http://www.aspninja.com/feed/" title="ASP Ninja latest posts" />
	<link rel="alternate" type="application/rss+xml" href="http://www.aspninja.com/comments/feed/" title="ASP Ninja latest comments" />
	<link rel="pingback" href="http://www.aspninja.com/xmlrpc.php" />
	
		<link rel='archives' title='January 2010' href='http://www.aspninja.com/2010/01/' />
	<link rel='archives' title='December 2009' href='http://www.aspninja.com/2009/12/' />
	
	<link rel="stylesheet" type="text/css" media="screen, print, handheld" href="http://www.aspninja.com/wp-content/themes/carrington-blog/css/typography.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://www.aspninja.com/wp-content/themes/carrington-blog/style.css" />
	<!--[if lt IE 8]>
		<link rel="stylesheet" href="http://www.aspninja.com/wp-content/themes/carrington-blog/css/ie.css" type="text/css" media="screen" charset="utf-8" />
	<![endif]-->
	<script type='text/javascript' src='http://www.aspninja.com/wp-includes/js/jquery/jquery.js?ver=1.3.2'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/themes/carrington-blog/js/carrington.js?ver=1.0'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.aspninja.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.aspninja.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='ASP Ninja' href='http://www.aspninja.com' />
<meta name="generator" content="WordPress 2.9.2" />
<link href='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/styles/shCore.css' type='text/css' rel='stylesheet' /><link href='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/styles/shThemeDefault.css' type='text/css' rel='stylesheet' id='shTheme'/><script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shCore.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushAS3.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushBash.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushCSharp.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushCpp.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushCss.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushDelphi.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushDiff.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushGroovy.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushJScript.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushJava.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushJavaFX.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushPerl.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushPhp.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushPlain.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushPowerShell.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushPython.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushRuby.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushScala.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushSql.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushVb.js'></script>
<script type='text/javascript' src='http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/shBrushXml.js'></script>
<script type='text/javascript'>
SyntaxHighlighter.config.clipboardSwf = 'http://www.aspninja.com/wp-content/plugins/easy-google-syntax-highlighter/scripts/clipboard.swf';
SyntaxHighlighter.all();</ScripT>

<script type="text/javascript">
var CFCT_URL = "http://www.aspninja.com";
var CFCT_AJAX_LOAD = true;
</script>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta name="wassup-version" content="1.7.2.1" />
<script type="text/javascript">
//<![CDATA[
	var screen_res = "";
	function writeCookie(name,value,hours) {
		var the_cookie = name+"="+value+"; expires=";
		var expires = "";
		hours=hours+0; //convert to number
		if (hours > 0) { //0==expires on browser close
			var date = new Date();
			date.setTime(date.getTime()+(hours*60*60*1000));
			expires = expires+date.toGMTString();
		} 
		document.cookie = the_cookie+expires+"; path=/; domain=";
	}
	screen_res = window.screen.width+"x"+window.screen.height;
	writeCookie("wassup_screen_res",screen_res,"48"); //keep 2 days
//]]>
</script>
        <script type="text/javascript">
window.google_analytics_uacct = "UA-2007496-9";
</script>
</head>

<body class="wordpress y2010 m03 d14 h05 home blog">
	<div id="page">
		<p id="top"><a id="to-content" href="#content" title="Skip to content">Skip to content</a></p>
		<div id="header">
			<div class="wrapper">
				<strong id="blog-title"><a href="http://www.aspninja.com/" title="Home" rel="home">ASP Ninja</a></strong>
				<p id="blog-description">Adventures of an asp.net ninja</p>
				<div id="navigation">
					<ul>
												<li class="secondary"><a href="http://www.aspninja.com/wp-login.php">Log In</a></li>						 
					</ul>
				</div><!-- #navigation -->
			</div><!-- .wrapper -->
		</div><!-- #header -->
		<div id="sub-header">
			<div class="wrapper">
				
<form method="get" id="search" action="http://www.aspninja.com/">
	<div>
		<input type="text" id="search-input" name="s" value="" size="15" />
		<input type="submit" name="submit_button" value="Search" />
	</div>
</form>				<div id="all-categories">
					<span class="heading">Categories:</span>
					<ul>
							<li class="cat-item cat-item-8"><a href="http://www.aspninja.com/category/code-snippets/" title="View all posts filed under Code snippets">Code snippets</a>
</li>
					</ul>
				</div><!-- #list-categories -->
			</div><!-- .wrapper -->
		</div><!--#sub-header-->
		<hr class="divider">
		<div class="wrapper">
<div id="content">
<div id="post-content-103" class="hentry full p1 post publish author-ninja category-code-snippets tag-asp-net tag-c tag-redis y2010 m01 d23 h14">
	<h1 class="entry-title full-title"><a href="http://www.aspninja.com/2010/01/23/using-redis-on-asp-net-example-twitter-clone-retwis-c/" title="Permanent link to Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#)" rel="bookmark" rev="post-103">Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#)</a></h1>
	<div class="entry-content full-content">
		<p><a href="http://code.google.com/p/redis/" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');"><img src="http://www.aspninja.com/wp-content/uploads/2010/01/redis.png" alt="" title="redis" width="108" height="82" class="alignright size-full wp-image-109" /></a><a href="http://code.google.com/p/redis/" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');" target="_blank">Redis</a> (REmote DIctionary Server) is an advanced key-value store written in C. It can be used like memcached, in front of a traditional database, or on its own thanks to the fact that the in-memory datasets is not volatile, and values can be strings, but also lists, sets, and ordered sets and can be persisted on disk.</p>
<blockquote><p>In order to be very fast but at the same time persistent the whole dataset is taken in memory, and from time to time saved on disc asynchronously (semi persistent mode) or alternatively every change is written into an append only file (fully persistent mode). Redis is able to rebuild the append only file in background when it gets too big.</p>
<div style="text-align: center;margin: 3px;"><script type="text/javascript"><!--
google_ad_client = "pub-4816769628062611";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text";
google_ad_channel ="";
google_color_border = "#FFFFFF";
google_color_link = "#A00004";
google_color_bg = "";
google_color_text = "";
google_color_url = "#A00004";
google_ui_features = "rc:0";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><p>Redis supports trivial to setup master-slave replication, with very fast non-blocking first synchronization, auto reconnection on net split, and so forth.</p></blockquote>
<p>Fortunately, it already has client libraries for several languages: Python, PHP, Ruby, Java etc. Miguel De Icaza has already started a client library (called <a href="http://github.com/migueldeicaza/redis-sharp" onclick="javascript:pageTracker._trackPageview('/outbound/article/github.com');" target="_blank">redis-sharp</a>) for C#, but lacks a lot of <a href="http://code.google.com/p/redis/wiki/CommandReference" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');" target="_blank">Redis command</a>.</p>
<p><a href="http://twitter.com/antirez" onclick="javascript:pageTracker._trackPageview('/outbound/article/twitter.com');" target="_blank">Salvatore Sanfilippo</a> has implemented a Twitter clone known as <a href="http://retwis.antirez.com/" onclick="javascript:pageTracker._trackPageview('/outbound/article/retwis.antirez.com');" target="_blank">Retwis</a> to showcase how you can use Redis and PHP to build applications without the need for a database like MySQL or any SQL query. He used PHP in order to reach a wide audience, but I also wanted to learn more about the Redist possibilities and it seemed the best idea to port the Retwis to C#/ASP.NET.</p>
<p>Unfortunately, the <a href="http://code.google.com/p/redis/downloads/list" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');">Downloads tab</a> doesn&#8217;t contain any windows build of Redis, but you can compile your own using Cygwin. You can download my build for Redis ver. 1.2.1 stable branch from <a href="http://aspninja.com/wp-content/uploads/2010/01/Redis-1.2.1.zip" onclick="javascript:pageTracker._trackPageview('/downloads/wp-content/uploads/2010/01/Redis-1.2.1.zip');" target="_blank">here</a>. There is no other than to do after unpacking then start the redis-server.exe.</p>
<p><img src="http://www.aspninja.com/wp-content/uploads/2010/01/retwis-csharp.png" alt="" title="retwis-csharp" width="510" height="229" class="aligncenter size-full wp-image-114" /></p>
<p>I don&#8217;t want to go deep in to write about the Redis <a href="http://code.google.com/p/redis/wiki/ProtocolSpecification" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');" target="_blank">protocol</a>  and <a href="http://code.google.com/p/redis/wiki/CommandReference" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');" target="_blank">commands</a>, because you can find detailed informations in the wiki. Salvatore also published a <a href="http://code.google.com/p/redis/wiki/TwitterAlikeExample" onclick="javascript:pageTracker._trackPageview('/outbound/article/code.google.com');" target="_blank">beginner’s article</a> based on the PHP Twitter clone he wrote. But I don&#8217;t really want to breed more of the word, <a href="http://aspninja.com/wp-content/uploads/2010/01/Retwis-csharp.zip" onclick="javascript:pageTracker._trackPageview('/downloads/wp-content/uploads/2010/01/Retwis-csharp.zip');" target="_blank">click here</a> to download the fully working Retwis example and the extended version of redis-sharp client library, it says more than a thousand words&#8230;</p>
	</div><!--/entry-content-->
	<p class="filed">
		<span class="categories">Posted in <a href="http://www.aspninja.com/category/code-snippets/" title="View all posts in Code snippets" rel="category tag">Code snippets</a>.</span> 
		<span class="tags">Tagged with <a href="http://www.aspninja.com/tag/asp-net/" rel="tag">ASP.NET</a>, <a href="http://www.aspninja.com/tag/c/" rel="tag">C#</a>, <a href="http://www.aspninja.com/tag/redis/" rel="tag">Redis</a>.</span>	</p><!--/filed-->
	<div class="by-line">
		<address class="author vcard full-author">
			<span class="by">By</span> <a class="url fn" href="http://www.aspninja.com/author/admin/" title="View all posts by ninja">ninja</a>		</address>
		<span class="date full-date"><abbr class="published" title="2010-01-23T14:18:16-0800">January 23, 2010</abbr></span>
	</div><!--/by-line-->
	<p class="comments-link"><a href="http://www.aspninja.com/2010/01/23/using-redis-on-asp-net-example-twitter-clone-retwis-c/#comments" rev="post-103"  title="Comment on Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#)">1 comment</a></p>
	<div class="clear"></div>
	<div id="post-comments-103-target"></div>
	</div><!-- .post --><div id="post-content-67" class="hentry full p2 post publish author-ninja category-code-snippets tag-asp-net tag-c tag-firebug tag-firephp tag-log4net tag-logging y2010 m01 d21 h05 alt">
	<h1 class="entry-title full-title"><a href="http://www.aspninja.com/2010/01/21/how-to-debug-asp-net-using-firefox/" title="Permanent link to How to debug ASP.NET using Firefox" rel="bookmark" rev="post-67">How to debug ASP.NET using Firefox</a></h1>
	<div class="entry-content full-content">
		<div style="text-align: center;margin: 3px;"><script type="text/javascript"><!--
google_ad_client = "pub-4816769628062611";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text";
google_ad_channel ="";
google_color_border = "#FFFFFF";
google_color_link = "#A00004";
google_color_bg = "";
google_color_text = "";
google_color_url = "#A00004";
google_ui_features = "rc:0";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><p>I must admit, I&#8217;m a huge fan of <a href="http://logging.apache.org/log4net/index.html" onclick="javascript:pageTracker._trackPageview('/outbound/article/logging.apache.org');" target="_blank">log4net</a>, and I always use it for logging. The other essential ingredient of the web development is the Firefox (and <a href="http://getfirebug.com/" onclick="javascript:pageTracker._trackPageview('/outbound/article/getfirebug.com');" target="_blank">FireBug</a>, of course), so it gives me the idea that it should be great to send the server-side logging events to the client side in easily readable format. Of course, we can look for the necessary informations in the log files or in the event log (you can find a huge number of log4net appenders), but this is not an easy task, if you should do it in the large amount of entries. But rather we look at how we could make it easier to debug.</p>
<p>If we already have Firefox, the clear answer to our question is the usage of <a href="http://www.firephp.org/" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.firephp.org');" target="_blank">FirePHP Extension</a>. The extension itself could not be better summarized as you can read on its homepage:</p>
<blockquote><p>FirePHP enables you to log to your Firebug Console using a simple PHP method call.</p>
<p>All data is sent via response headers and will not interfere with the content on your page.</p>
<p>FirePHP is ideally suited for AJAX development where clean JSON and XML responses are required.</p></blockquote>
<p>As you can see, the FirePHP choose the same way as I showed you in my previous post: send back the informations in the HTTP header sent in a predefined protocol. Only the &#8220;simple PHP method&#8221; wording should be translated to &#8220;simple C# method&#8221;. To do this, there is no need anything else than to write a simple log4net appender which sends the logging events back to the client in the HTTP header.</p>
<pre class="brush: csharp;">

#region Override implementation of AppenderSkeleton

/// &lt;summary&gt;
/// Write the logging event to the FirePHP
/// &lt;/summary&gt;
/// &lt;param name="loggingEvent"&gt;the event to log&lt;/param&gt;
/// &lt;remarks&gt;
/// &lt;para&gt;
/// Write the logging event to the FireBug Console
/// &lt;/para&gt;
/// &lt;/remarks&gt;
override protected void Append(LoggingEvent loggingEvent)
{
    HttpContext context = HttpContext.Current;
    if (context == null)
        return;

    //Initialize the neccessary headers
    InitHeader(context.Response);

    string logType = String.Empty;
    switch (loggingEvent.Level.Name.ToUpper())
    {
        case "WARN":
            logType = "WARN";
            break;

        case "ERROR":
        case "FATAL":
            logType = "ERROR";
            break;

        case "INFO":
            logType = "INFO";
            break;

        default:
            logType = "LOG";
            break;
    }

     //Converts the logging event to JSON format.
    string json = "[{\"Type\":\"" + logType + "\"},\"" + PrepareData(RenderLoggingEvent(loggingEvent)) + "\"]";
    //Append the logggint event to the header
     context.Response.AppendHeader(String.Format("X-Wf-1-1-1-{0}", (LogCounter++)), String.Format("{0}|{1}|", json.Length, json));
}

#endregion
</pre>
<p>Sounds simple? Yes, it is. In the <a href="http://www.aspninja.com/wp-content/uploads/2010/01/FirePHPAppenderExample.zip" onclick="javascript:pageTracker._trackPageview('/downloads/wp-content/uploads/2010/01/FirePHPAppenderExample.zip');" target="_blank">example application</a> I included the previous post revised code, which is now use the log4net to log the execution time (and of course, you can see it in the FireBug console).</p>
<p><a href="http://www.aspninja.com/wp-content/uploads/2010/01/firephp.png" ><img class="aligncenter size-full wp-image-84" title="firephp" src="http://www.aspninja.com/wp-content/uploads/2010/01/firephp.png" alt="" /></a></p>
<p>Of course, the above example doesn&#8217;t take <a href="http://www.firephp.org/Examples/PHPArchitect/" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.firephp.org');" target="_blank">full advantage</a> of the FirePHP extension, it&#8217;s just a simple but powerful tool to help your daily job.</p>
<p>However, don&#8217;t use it continuously in your production environment is not used, because it can send too sensitive information to those who have do not want to. So do not forget to remove the appender reference from the log4net.config file, if you no longer need it.</p>
	</div><!--/entry-content-->
	<p class="filed">
		<span class="categories">Posted in <a href="http://www.aspninja.com/category/code-snippets/" title="View all posts in Code snippets" rel="category tag">Code snippets</a>.</span> 
		<span class="tags">Tagged with <a href="http://www.aspninja.com/tag/asp-net/" rel="tag">ASP.NET</a>, <a href="http://www.aspninja.com/tag/c/" rel="tag">C#</a>, <a href="http://www.aspninja.com/tag/firebug/" rel="tag">FireBug</a>, <a href="http://www.aspninja.com/tag/firephp/" rel="tag">FirePHP</a>, <a href="http://www.aspninja.com/tag/log4net/" rel="tag">log4net</a>, <a href="http://www.aspninja.com/tag/logging/" rel="tag">Logging</a>.</span>	</p><!--/filed-->
	<div class="by-line">
		<address class="author vcard full-author">
			<span class="by">By</span> <a class="url fn" href="http://www.aspninja.com/author/admin/" title="View all posts by ninja">ninja</a>		</address>
		<span class="date full-date"><abbr class="published" title="2010-01-21T05:40:05-0800">January 21, 2010</abbr></span>
	</div><!--/by-line-->
	<p class="comments-link"><a href="http://www.aspninja.com/2010/01/21/how-to-debug-asp-net-using-firefox/#respond" rev="post-67"  title="Comment on How to debug ASP.NET using Firefox">No comments</a></p>
	<div class="clear"></div>
	<div id="post-comments-67-target"></div>
	</div><!-- .post --><div id="post-content-4" class="hentry full p3 post publish author-ninja category-code-snippets tag-asp-net tag-c tag-execution-time tag-httpmodule tag-latency tag-performance y2009 m12 d21 h07">
	<h1 class="entry-title full-title"><a href="http://www.aspninja.com/2009/12/21/efficient-way-to-measure-and-collect-information-about-execution-time/" title="Permanent link to Efficient way to measure and collect information about execution time" rel="bookmark" rev="post-4">Efficient way to measure and collect information about execution time</a></h1>
	<div class="entry-content full-content">
		<p>In technical point of view, many factor influence the first impression, success and usability of your website. One of the most important key factor is the load time: in very simple terms this time (or more precisely: delay/latency) refers to the initiation of visitor&#8217;s request and the start of browser rendering. The total delay/latency usually divided into two parts:</p>
<ul>
<li>server latency (the time that it takes to render the request and then transmit it to the user)</li>
<li>network latency (round trip time between your computer and the server)</li>
</ul>
<p>Although there is plenty of opportunity to optimize the network latency (enable gzip compression, minify javasript and css files, downloads parallelize across hostnames, combine javascript files etc..), but int the first step we should should concentrate on the server latency. Why is load time so important? When a visitor comes to your site for the first time an initial impression will be formed in seconds. A good impression will increase the chances of that visitor returning again, and a bad impression will be difficult to overcome. Not to mention that the load time can have an<a href="http://gigaom.com/2009/11/22/should-web-page-speed-influence-google-pagerank/" onclick="javascript:pageTracker._trackPageview('/outbound/article/gigaom.com');" target="_blank"> impact on your search engine result position</a>.</p>
<p>It sounds great but we must measure this latency to start the investigation and optimization. The client tools can measure only the total load time (e.g. Firebug), since they do not have any information about how long the response was produced at server-side. So the task is simple: send this information to the client. Many <a href="http://www.dominicpettifer.co.uk/Blog/10/measuring-page-execution-times-for-asp-net-pages" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.dominicpettifer.co.uk');" target="_blank">examples</a> can be found where the server execution time is written into the HTML body, but I&#8217;ve some problems with this solution: sees everyone (Of course you can hide it) and as a part of the content it can be confusing in a json-based response.</p>
<p>The most obvious solution is to simply send this information back to the client in a HTTP header with an HTTPModule. After that you can look at it with <a href="http://getfirebug.com/" onclick="javascript:pageTracker._trackPageview('/outbound/article/getfirebug.com');" target="_self">Firebug </a>or <a href="http://www.fiddler2.com/fiddler2/" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.fiddler2.com');" target="_blank">Fiddler</a>.</p>
<p>Why I chose <a href="http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.aspx" onclick="javascript:pageTracker._trackPageview('/outbound/article/msdn.microsoft.com');" target="_self">HTTPModule</a>? Because when the request gets sent to the HTTPApplication object, it then gets sent to any HTTPModules that are registered in the web.config file of the website. Two things must be achieved in the module:  store the time of request beginning and at the end of request send back the elapsed time in a  HTTP response header. Let&#8217;s translate it into the language of HTTPModule: in the  Init method (initializes a module and prepares it to handle requests) of HTTPModule we register for HttpApplication events by adding handlers for BeginRequest and EndRequest.</p>
<pre class="brush: csharp;">#region Private static members

//Holds the key of item to store the beginning time of request processing
private static readonly string requestTimeSlotName = "reqTime";

//Holds the name of the HTTP Response header
private static readonly string responseHeaderName = "_Execution";

#endregion

#region IHttpModule Methods

// In the Init function, register for HttpApplication events by adding handlers.
public void Init(HttpApplication app)
{
    app.BeginRequest += new EventHandler(app_BeginRequest);
    app.EndRequest += new EventHandler(app_EndRequest);
}

//Disposes of the resources used by the module that implements IHttpModule.
public void Dispose()
{
}

#endregion</pre>
<div style="text-align: center;margin: 3px;"><script type="text/javascript"><!--
google_ad_client = "pub-4816769628062611";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text";
google_ad_channel ="";
google_color_border = "#FFFFFF";
google_color_link = "#A00004";
google_color_bg = "";
google_color_text = "";
google_color_url = "#A00004";
google_ui_features = "rc:0";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><p>In the app_BeginRequest event handler we create the HttpApplication and HttpContext objects to access request, response properties and we add the time of request beginning to the HttpContext.Items collection.</p>
<pre class="brush: csharp;">//Occurs as the first event in the HTTP pipeline chain of execution when ASP.NET responds to a request
private void app_BeginRequest(object sender, EventArgs e)
{
    // Create HttpApplication and HttpContext objects to access request and response properties.
    HttpApplication app = (HttpApplication)sender;
    HttpContext context = app.Context;

    //Store the time of request beginning
    if (context != null)
        context.Items.Add(requestTimeSlotName, DateTime.Now);
}</pre>
<p>After the creation of HttpApplication, HttpContext and HttpResponse object in the app_EndRequest method, we should read the stored date from HttpContext.Items collection and calculate the elapsed time since then. The last step is to write the custom header into the HTTP response by the AddHeader method.<br />
As you can see in the following code, not just the execution time will be written into the header, but the time of beginning process and the server name to which the answer was. The server name can be very useful when you run your site in a webfarm, which constantly change which server to serve the request.</p>
<pre class="brush: csharp;">//Occurs as the last event in the HTTP pipeline chain of execution when ASP.NET responds to a request
private void app_EndRequest(object sender, EventArgs e)
{
    // Create HttpApplication, HttpContext and HttpRespoonse objects to access request and response properties.
    HttpApplication app = (HttpApplication)sender;
    HttpContext context = app.Context;
    if (context == null)
       return;
    HttpResponse response = context.Response;

    //Get the time of request beginning
    object item = HttpContext.Current.Items[requestTimeSlotName];
    if (item != null)
    {
        //Calculate the elapsed time since the beginning
        TimeSpan ts = DateTime.Now - (DateTime)item;

        try
        {
            //Write the informations to a custom reponse header
            response.AddHeader(responseHeaderName, string.Format("{2} -&gt; {1} sec. @ {0}", ((DateTime)item).ToString(), (ts.TotalMilliseconds / 1000).ToString(), app.Context.Server.MachineName));
         } catch (HttpException exc) { }
    }
}</pre>
<p>Why do we need catch the HttpException? Simply because there may be situations when it is not possible to write to the HTTP header (e.g. Response.Flush sends the HTTP headers &#8211; since they must appear at the beginning, or head, of the message) and then the &#8220;Server can not append header after HTTP headers have been sent&#8221; error message appears.</p>
<p>In the last step you must modify the configuration settings in web.config to let your website know about the HttpModule and you can start to to monitor response headers by your favorite client tools. The module itself can be used in production environment, since no sensitive information is not included.</p>
<p><a href="http://www.aspninja.com/wp-content/uploads/2009/12/executiontime.png" ><img class="aligncenter size-medium wp-image-54" title="Check Response Header in Firebug" src="http://www.aspninja.com/wp-content/uploads/2009/12/executiontime.png" alt="" /></a></p>
<p>I hope this simple trick help your work, and the working example can be downloaded from <a href="http://www.aspninja.com/wp-content/uploads/2009/12/ExecutionTimeExample.zip" onclick="javascript:pageTracker._trackPageview('/downloads/wp-content/uploads/2009/12/ExecutionTimeExample.zip');">here</a>.</p>
	</div><!--/entry-content-->
	<p class="filed">
		<span class="categories">Posted in <a href="http://www.aspninja.com/category/code-snippets/" title="View all posts in Code snippets" rel="category tag">Code snippets</a>.</span> 
		<span class="tags">Tagged with <a href="http://www.aspninja.com/tag/asp-net/" rel="tag">ASP.NET</a>, <a href="http://www.aspninja.com/tag/c/" rel="tag">C#</a>, <a href="http://www.aspninja.com/tag/execution-time/" rel="tag">Execution Time</a>, <a href="http://www.aspninja.com/tag/httpmodule/" rel="tag">HttpModule</a>, <a href="http://www.aspninja.com/tag/latency/" rel="tag">Latency</a>, <a href="http://www.aspninja.com/tag/performance/" rel="tag">Performance</a>.</span>	</p><!--/filed-->
	<div class="by-line">
		<address class="author vcard full-author">
			<span class="by">By</span> <a class="url fn" href="http://www.aspninja.com/author/admin/" title="View all posts by ninja">ninja</a>		</address>
		<span class="date full-date"><abbr class="published" title="2009-12-21T07:04:28-0800">December 21, 2009</abbr></span>
	</div><!--/by-line-->
	<p class="comments-link"><a href="http://www.aspninja.com/2009/12/21/efficient-way-to-measure-and-collect-information-about-execution-time/#comments" rev="post-4"  title="Comment on Efficient way to measure and collect information about execution time">1 comment</a></p>
	<div class="clear"></div>
	<div id="post-comments-4-target"></div>
	</div><!-- .post --><div class="pagination">
	<span class="previous"></span>
	<span class="next"></span>
</div></div><!--#content-->


<div id="sidebar">
	<div id="carrington-subscribe" class="widget">
		<h2 class="widget-title">Subscribe</h2>
		<a class="feed" title="RSS 2.0 feed for posts" rel="alternate" href="http://www.aspninja.com/feed/">Site <acronym title="Really Simple Syndication">RSS</acronym> feed</a>
	</div><!--.widget-->

	<div id="primary-sidebar">
		<div id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="title">Recent Posts</h2>		<ul>
				<li><a href="http://www.aspninja.com/2010/01/23/using-redis-on-asp-net-example-twitter-clone-retwis-c/" title="Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#)">Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#) </a></li>
				<li><a href="http://www.aspninja.com/2010/01/21/how-to-debug-asp-net-using-firefox/" title="How to debug ASP.NET using Firefox">How to debug ASP.NET using Firefox </a></li>
				<li><a href="http://www.aspninja.com/2009/12/21/efficient-way-to-measure-and-collect-information-about-execution-time/" title="Efficient way to measure and collect information about execution time">Efficient way to measure and collect information about execution time </a></li>
				</ul>
		</div>		<div id="recent-comments-3" class="widget widget_recent_comments">			<h2 class="title">Recent Comments</h2>			<ul id="recentcomments"><li class="recentcomments"><a href="http://topsy.com/tb/bit.ly/5wnfBb" onclick="javascript:pageTracker._trackPageview('/outbound/commentauthor/topsy.com');"  rel='external nofollow' class='url'>Tweets that mention Using Redis on ASP.NET – Example Twitter clone (Retwis-C#) – ASP Ninja -- Topsy.com</a> on <a href="http://www.aspninja.com/2010/01/23/using-redis-on-asp-net-example-twitter-clone-retwis-c/comment-page-1/#comment-38">Using Redis on ASP.NET &#8211; Example Twitter clone (Retwis-C#)</a></li><li class="recentcomments">bin on <a href="http://www.aspninja.com/2009/12/21/efficient-way-to-measure-and-collect-information-about-execution-time/comment-page-1/#comment-2">Efficient way to measure and collect information about execution time</a></li></ul>
		</div>	</div><!--#primary-sidebar-->
	<div id="secondary-sidebar">
<div id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="title">Tags</h2><div><a href='http://www.aspninja.com/tag/asp-net/' class='tag-link-3' title='3 topics' style='font-size: 22pt;'>ASP.NET</a>
<a href='http://www.aspninja.com/tag/c/' class='tag-link-13' title='3 topics' style='font-size: 22pt;'>C#</a>
<a href='http://www.aspninja.com/tag/execution-time/' class='tag-link-4' title='1 topic' style='font-size: 8pt;'>Execution Time</a>
<a href='http://www.aspninja.com/tag/firebug/' class='tag-link-11' title='1 topic' style='font-size: 8pt;'>FireBug</a>
<a href='http://www.aspninja.com/tag/firephp/' class='tag-link-10' title='1 topic' style='font-size: 8pt;'>FirePHP</a>
<a href='http://www.aspninja.com/tag/httpmodule/' class='tag-link-6' title='1 topic' style='font-size: 8pt;'>HttpModule</a>
<a href='http://www.aspninja.com/tag/latency/' class='tag-link-7' title='1 topic' style='font-size: 8pt;'>Latency</a>
<a href='http://www.aspninja.com/tag/log4net/' class='tag-link-12' title='1 topic' style='font-size: 8pt;'>log4net</a>
<a href='http://www.aspninja.com/tag/logging/' class='tag-link-9' title='1 topic' style='font-size: 8pt;'>Logging</a>
<a href='http://www.aspninja.com/tag/performance/' class='tag-link-5' title='1 topic' style='font-size: 8pt;'>Performance</a>
<a href='http://www.aspninja.com/tag/redis/' class='tag-link-14' title='1 topic' style='font-size: 8pt;'>Redis</a></div>
</div><div id="archives-3" class="widget widget_archive"><h2 class="title">Archives</h2>		<ul>
			<li><a href='http://www.aspninja.com/2010/01/' title='January 2010'>January 2010</a>&nbsp;(2)</li>
	<li><a href='http://www.aspninja.com/2009/12/' title='December 2009'>December 2009</a>&nbsp;(1)</li>
		</ul>
</div>	</div><!--#secondary-sidebar-->
</div><!--#sidebar-->
		</div><!-- .wrapper-->
		<hr class="divider" />
		<div id="footer">
			<div class="wrapper">		
				<p id="generator-link">Proudly powered by <a href="http://wordpress.org/" title="WordPress" rel="generator">WordPress</a></span> and <span id="theme-link"><a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a></span>.</p>
				<p id="developer-link"><a href="http://crowdfavorite.com" title="Custom WordPress development, design and backup services." rel="developer designer">Carrington Theme by Crowd Favorite</a></p>
			</div><!--.wrapper-->
		</div><!--#footer -->
	</div><!--#page-->
	
<!-- Google Analytics for WordPress | http://yoast.com/wordpress/google-analytics/ -->
<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
	try {
		var pageTracker = _gat._getTracker("UA-2007496-9");
		// Cookied already: 
		pageTracker._trackPageview();
	} catch(err) {}
</script>
<!-- End of Google Analytics code -->
<!--
<p class="small"> WassUp 1.7.2.1 timestamp: 2010-03-14 05:52:26AM GMT+8 (05:52AM)<br />
If above timestamp is not current time, this page is cached.</p> -->
</body>
</html>